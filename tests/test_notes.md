# Debugging notes
## Hessian is correct, need to get the other terms

## What I'm expecting

4.       2.5      1.      -0.5      7.       9.5      12.     14.5
10.5     12.25    14.      15.75    15.5     24.25    33.     41.75
-3.75   -11.125  -18.5    -25.875    5.25     8.875   12.5    16.125
-4.625  -13.3125 -22.     -30.6875  10.125   14.1875  18.25   22.3125

## What I'm getting
6.          8.5         11.         13.5        21.5        27.         32.5        38.
16.5        25.25       34.         42.75       25.64999962 34.39999962 43.14999962 51.89999962
12.35000014 17.7750001  23.20000029 28.625      18.24499989 21.86999989 25.49499989 29.11999989
6.625       10.6875     14.75       18.8125     18.41249943 22.47499943 26.53749943 30.59999943



# Expected pieces
(Pdb) user_1_block_1_non_cross_term_contribution
array([[22.   , 33.   , 44.   , 55.   ],
       [35.   , 52.5  , 70.   , 87.5  ],
       [14.5  , 21.75 , 29.   , 36.25 ],
       [16.25 , 24.375, 32.5  , 40.625]])

(Pdb) user_2_block_1_non_cross_term_contribution
array([[0., 0., 0., 0.],
       [0., 0., 0., 0.],
       [0., 0., 0., 0.],
       [0., 0., 0., 0.]])

(Pdb) user_1_block_2_non_cross_term_contribution
array([[11.   , 22.   , 33.   , 44.   ],
       [17.5  , 35.   , 52.5  , 70.   ],
       [ 7.25 , 14.5  , 21.75 , 29.   ],
       [ 8.125, 16.25 , 24.375, 32.5  ]])

(Pdb) user_2_block_2_non_cross_term_contribution
array([[31.9999979 , 31.9999979 , 31.9999979 , 31.9999979 ],
       [33.799998  , 33.799998  , 33.799998  , 33.799998  ],
       [29.23999823, 29.23999823, 29.23999823, 29.23999823],
       [28.6999982 , 28.6999982 , 28.6999982 , 28.6999982 ]])

(Pdb) block_1_non_cross_term
array([[11.    , 16.5   , 22.    , 27.5   ],
       [17.5   , 26.25  , 35.    , 43.75  ],
       [ 7.25  , 10.875 , 14.5   , 18.125 ],
       [ 8.125 , 12.1875, 16.25  , 20.3125]])

(Pdb) block_2_non_cross_term
array([[21.49999895, 26.99999895, 32.49999895, 37.99999895],
       [25.649999  , 34.399999  , 43.149999  , 51.899999  ],
       [18.24499911, 21.86999911, 25.49499911, 29.11999911],
       [18.4124991 , 22.4749991 , 26.5374991 , 30.5999991 ]])

(Pdb) user_1_block_1_cross_term_contribution
array([[-14., -28., -42., -56.],
       [-14., -28., -42., -56.],
       [-22., -44., -66., -88.],
       [-22., -44., -66., -88.]])

(Pdb) block_1_cross_term
array([[ -7.  , -14.  , -21.  , -28.  ],
       [ -7.  , -14.  , -21.  , -28.  ],
       [-11.  , -22.  , -33.  , -44.  ],
       [-12.75, -25.5 , -38.25, -51.  ]])

(Pdb) user_1_block_2_cross_term_contribution
array([[ 2.,  2.,  2.,  2.],
       [-2., -2., -2., -2.],
       [-2., -2., -2., -2.],
       [ 2.,  2.,  2.,  2.]])

(Pdb) user_2_block_2_cross_term_contribution
array([[-1.20000000e+01, -1.80000000e+01, -2.40000000e+01,
        -3.00000000e+01],
       [-0.00000000e+00, -0.00000000e+00, -0.00000000e+00,
        -0.00000000e+00],
       [-2.00000001e-07, -3.00000001e-07, -4.00000001e-07,
        -5.00000001e-07],
       [-0.00000000e+00, -0.00000000e+00, -0.00000000e+00,
        -0.00000000e+00]])

(Pdb) block_2_cross_term
array([[ -4.        ,  -7.        , -10.        , -13.        ],
       [ -2.        ,  -2.        ,  -2.        ,  -2.        ],
       [ -2.0000001 ,  -2.00000015,  -2.0000002 ,  -2.00000025],
       [  2.        ,   2.        ,   2.        ,   2.        ]])


# What I'm getting

(Pdb) user_1_block_1_non_cross_term_contribution
array([[22.   , 33.   , 44.   , 55.   ],
       [35.   , 52.5  , 70.   , 87.5  ],
       [14.5  , 21.75 , 29.   , 36.25 ],
       [16.25 , 24.375, 32.5  , 40.625]])

(Pdb) user_1_block_1_cross_term_contribution
array([[ 2.,  2.,  2.,  2.],
       [-2., -2., -2., -2.],
       [ 3.,  3.,  3.,  3.],
       [-3., -3., -3., -3.]], dtype=float32)

(Pdb) running_entry_holder
array([[24.   , 35.   , 46.   , 57.   ],
       [33.   , 50.5  , 68.   , 85.5  ],
       [17.5  , 24.75 , 32.   , 39.25 ],
       [13.25 , 21.375, 29.5  , 37.625]])



Next steps:  Make test construction of expected terms more clear so it's more obvious that it's right.

Then isolate the pi derivatives and the rest in the expected to get the right format of the mixed derivatives wrt pi, and also test out the outer product style of multiplication vs whatever I'm actually doing.

UPDATE: Only first block is wrong! This is great news.

EXPECTED:
(Pdb) user_1_block_1_non_cross_term_contribution
array([[22.   , 33.   , 44.   , 55.   ],
       [35.   , 52.5  , 70.   , 87.5  ],
       [14.5  , 21.75 , 29.   , 36.25 ],
       [16.25 , 24.375, 32.5  , 40.625]])

(Pdb) user_2_block_1_non_cross_term_contribution
array([[0., 0., 0., 0.],
       [0., 0., 0., 0.],
       [0., 0., 0., 0.],
       [0., 0., 0., 0.]])

(Pdb) user_1_block_1_cross_term_contribution
array([[-14., -28., -42., -56.],
       [-14., -28., -42., -56.],
       [-22., -44., -66., -88.],
       [-22., -44., -66., -88.]])

(Pdb)  user_1_block_1_cross_term_derivative_wrt_pi
array([-14., -14., -22., -22.])

(Pdb) block_1
array([[ -3.    , -11.5   , -20.    , -28.5   ],
       [  3.5   ,  -1.75  ,  -7.    , -12.25  ],
       [-14.75  , -33.125 , -51.5   , -69.875 ],
       [-13.875 , -31.8125, -49.75  , -67.6875]])
